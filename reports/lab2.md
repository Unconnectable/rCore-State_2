# é—®ç­”ä½œä¸š

## 1.å®ç°çš„åŠŸèƒ½

åœ¨å¼•å…¥`PageTable`ä¹‹åå®ç°äº†`sys_trace`å¯¹`sys_call`çš„è®°å½•,é‡æ–°è·å–`syts_gettime`ï¼ŒåŒæ ·åœ¨`memory_set`æ–‡ä»¶ä¸­å¼•å…¥äº†`mmap munmap`å‡½æ•°ï¼Œåœ¨`/task/mod.rs`ä¸­å®ç°äº†å¯¹ç‰©ç†é¡µçš„åˆ†é…å’Œå–æ¶ˆæ˜ å°„

## 2.é—®ç­”é¢˜

### 1.è¯·åˆ—ä¸¾ SV39 é¡µè¡¨é¡µè¡¨é¡¹çš„ç»„æˆï¼Œæè¿°å…¶ä¸­çš„æ ‡å¿—ä½æœ‰ä½•ä½œç”¨ï¼Ÿ

ç»„æˆ:è™šæ‹Ÿåœ°å€39ä½ ä½12ä½æ˜¯åç§» é«˜27ä½æ˜¯è™šæ‹Ÿé¡µå·VPN,ç‰©ç†åœ°å€56ä½ ä½12ä½æ˜¯åç§» é«˜44ä½æ˜¯ç‰©ç†é¡µå·PPN

æ ‡å¿—ä½:ç¬¬å…«ä½[7:0]éƒ½æ˜¯æ ‡å¿—ä½,åˆ†åˆ«7åˆ°0æ˜¯ D A G U RWX V

- ä»…å½“ V(Valid) ä½ä¸º 1 æ—¶ï¼Œé¡µè¡¨é¡¹æ‰æ˜¯åˆæ³•çš„ï¼›
- R/W/X åˆ†åˆ«æ§åˆ¶ç´¢å¼•åˆ°è¿™ä¸ªé¡µè¡¨é¡¹çš„å¯¹åº”è™šæ‹Ÿé¡µé¢æ˜¯å¦å…è®¸è¯»/å†™/å–æŒ‡ï¼›
- U æ§åˆ¶ç´¢å¼•åˆ°è¿™ä¸ªé¡µè¡¨é¡¹çš„å¯¹åº”è™šæ‹Ÿé¡µé¢æ˜¯å¦åœ¨ CPU å¤„äº U ç‰¹æƒçº§çš„æƒ…å†µä¸‹æ˜¯å¦è¢«å…è®¸è®¿é—®ï¼›
- G æˆ‘ä»¬ä¸ç†ä¼šï¼›
- A(Accessed) è®°å½•è‡ªä»é¡µè¡¨é¡¹ä¸Šçš„è¿™ä¸€ä½è¢«æ¸…é›¶ä¹‹åï¼Œé¡µè¡¨é¡¹çš„å¯¹åº”è™šæ‹Ÿé¡µé¢æ˜¯å¦è¢«è®¿é—®è¿‡ï¼›
- D(Dirty) åˆ™è®°å½•è‡ªä»é¡µè¡¨é¡¹ä¸Šçš„è¿™ä¸€ä½è¢«æ¸…é›¶ä¹‹åï¼Œé¡µè¡¨é¡¹çš„å¯¹åº”è™šæ‹Ÿé¡µè¡¨æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚



### 2.ç¼ºé¡µ

ç¼ºé¡µæŒ‡çš„æ˜¯è¿›ç¨‹è®¿é—®é¡µé¢æ—¶é¡µé¢ä¸åœ¨é¡µè¡¨ä¸­æˆ–åœ¨é¡µè¡¨ä¸­æ— æ•ˆçš„ç°è±¡ï¼Œæ­¤æ—¶ MMU å°†ä¼šè¿”å›ä¸€ä¸ªä¸­æ–­ï¼Œ å‘ŠçŸ¥ os è¿›ç¨‹å†…å­˜è®¿é—®å‡ºäº†é—®é¢˜ã€‚os é€‰æ‹©å¡«è¡¥é¡µè¡¨å¹¶é‡æ–°æ‰§è¡Œå¼‚å¸¸æŒ‡ä»¤æˆ–è€…æ€æ­»è¿›ç¨‹ã€‚

- è¯·é—®å“ªäº›å¼‚å¸¸å¯èƒ½æ˜¯ç¼ºé¡µå¯¼è‡´çš„ï¼Ÿ
- å‘ç”Ÿç¼ºé¡µæ—¶ï¼Œæè¿°ç›¸å…³é‡è¦å¯„å­˜å™¨çš„å€¼ï¼Œä¸Šæ¬¡å®éªŒæè¿°è¿‡çš„å¯ä»¥ç®€ç•¥ã€‚

ç¼ºé¡µæœ‰ä¸¤ä¸ªå¸¸è§çš„åŸå› ï¼Œå…¶ä¸€æ˜¯ Lazy ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯ç›´åˆ°å†…å­˜é¡µé¢è¢«è®¿é—®æ‰å®é™…è¿›è¡Œé¡µè¡¨æ“ä½œã€‚ æ¯”å¦‚ï¼Œä¸€ä¸ªç¨‹åºè¢«æ‰§è¡Œæ—¶ï¼Œè¿›ç¨‹çš„ä»£ç æ®µç†è®ºä¸Šéœ€è¦ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ã€‚ä½†æ˜¯ os å¹¶ä¸ä¼šé©¬ä¸Šè¿™æ ·åšï¼Œ è€Œæ˜¯ä¼šä¿å­˜ .text æ®µåœ¨ç£ç›˜çš„ä½ç½®ä¿¡æ¯ï¼Œåœ¨è¿™äº›ä»£ç ç¬¬ä¸€æ¬¡è¢«æ‰§è¡Œæ—¶æ‰å®Œæˆä»ç£ç›˜çš„åŠ è½½æ“ä½œã€‚

- è¿™æ ·åšæœ‰å“ªäº›å¥½å¤„ï¼Ÿ

å…¶å®ï¼Œæˆ‘ä»¬çš„ mmap ä¹Ÿå¯ä»¥é‡‡å– Lazy ç­–ç•¥ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªç”¨æˆ·è¿›ç¨‹å…ˆåç”³è¯·äº† 10G çš„å†…å­˜ç©ºé—´ï¼Œ ç„¶åç”¨äº†å…¶ä¸­ 1M å°±ç›´æ¥é€€å‡ºäº†ã€‚æŒ‰ç…§ç°åœ¨çš„åšæ³•ï¼Œæˆ‘ä»¬æ˜¾ç„¶äºå¤§äº†ï¼Œè¿›è¡Œäº†å¾ˆå¤šæ²¡æœ‰æ„ä¹‰çš„é¡µè¡¨æ“ä½œã€‚

- å¤„ç† 10G è¿ç»­çš„å†…å­˜é¡µé¢ï¼Œå¯¹åº”çš„ SV39 é¡µè¡¨å¤§è‡´å ç”¨å¤šå°‘å†…å­˜ (ä¼°ç®—æ•°é‡çº§å³- å¯)ï¼Ÿ

- è¯·ç®€å•æ€è€ƒå¦‚ä½•æ‰èƒ½å®ç° Lazy ç­–ç•¥ï¼Œç¼ºé¡µæ—¶åˆå¦‚ä½•å¤„ç†ï¼Ÿæè¿°åˆç†å³å¯ï¼Œä¸éœ€è¦è€ƒè™‘å®ç°ã€‚ç¼ºé¡µçš„å¦ä¸€ä¸ªå¸¸è§åŸå› æ˜¯ swap ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯å†…å­˜é¡µé¢å¯èƒ½è¢«æ¢åˆ°ç£ç›˜ä¸Šäº†ï¼Œå¯¼è‡´å¯¹åº”é¡µé¢å¤±æ•ˆã€‚

- æ­¤æ—¶é¡µé¢å¤±æ•ˆå¦‚ä½•è¡¨ç°åœ¨é¡µè¡¨é¡¹(PTE)ä¸Š?



---

```rust
    /// Get the syscall times of the current 'Running' task ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´
    pub fn get_syscall_times(&self, syscall_id: usize) -> isize {
        let inner = TASK_MANAGER.inner.exclusive_access();
        let current = inner.current_task;
        inner.tasks[current].syscall_times[syscall_id] as isize
    }
```

`git rebase`çš„ä½¿ç”¨

```sh
git log -oneline #æŠŠ log è¾“å‡ºä¸ºä¸€è¡Œ

#æŸ¥çœ‹logå†å²åä½¿ç”¨rebaseå˜åŸº
filament@7945hx:~/Courses/2025s-rcore-Unconnectable$ git log --oneline
440d30a (HEAD -> ch4, origin/ch4) å®Œæˆch4
7ce602c ä¿®æ”¹reports
aef5b0d æµ‹è¯•ch4æ­£ç¡®ç¨‹åº¦
f0df504 è¿˜å·®unmap1çš„æµ‹è¯•
3bc5156 æœªå®Œæˆ
0b7c8e5 ç»§ç»­ch4
12c1e3d è¿˜å·®mapæµ‹è¯•
1672914 æµ‹è¯•ch4
ab507ee finish sys_trace
073b2ef æ·»åŠ äº†reports
eed20af æ³¨é‡Šä»£ç 
dbd3002 æ·»åŠ æ³¨é‡Š
4d98714 å¢åŠ äº†å¾ˆå¤šæ³¨é‡Š
4014758 [chore] remove continue-on-error to confirm correctness
18b6e57 Initialize ch4

#æ¯”å¦‚éœ€è¦ä¿ç•™ Initialize ch4 å’Œ[chore] remove continue-on-error to confirm correctness 
#æŠŠå‰©ä¸‹çš„åˆå¹¶ä¸ºä¸€ä¸ªcommit

git rebase -i 4014758^
#è¿›å…¥todoé¡µé¢
```

ä¿®æ”¹ä¸ºä»¥ä¸‹ä»£ç 

`pick 4014758`ï¼šä¿ç•™` [chore] `commit ä¸å˜ã€‚

`pick 4d98714`ï¼šä½œä¸ºåˆå¹¶çš„åŸºç¡€ commitã€‚

`squash dbd3002` åˆ° `squash 440d30a`ï¼šå°†åç»­ 12 ä¸ª commit åˆå¹¶åˆ° `4d98714`ï¼Œå½¢æˆä¸€ä¸ªæ–° commitã€‚

```math
pick 4014758 [chore] remove continue-on-error to confirm correctness
pick 4d98714 å¢åŠ äº†å¾ˆå¤šæ³¨é‡Š
squash dbd3002 æ·»åŠ æ³¨é‡Š
squash eed20af æ³¨é‡Šä»£ç 
squash 073b2ef æ·»åŠ äº†reports
squash ab507ee finish sys_trace
squash 1672914 æµ‹è¯•ch4
squash 12c1e3d è¿˜å·®mapæµ‹è¯•
squash 0b7c8e5 ç»§ç»­ch4
squash 3bc5156 æœªå®Œæˆ
squash f0df504 è¿˜å·®unmap1çš„æµ‹è¯•
squash aef5b0d æµ‹è¯•ch4æ­£ç¡®ç¨‹åº¦
squash 7ce602c ä¿®æ”¹reports
squash 440d30a å®Œæˆch4
```

æ¥ä¸‹æ¥éœ€è¦ç¼–è¾‘æ–°çš„commitæ¶ˆæ¯

```sh
å®Œæˆ ch4 å¼€å‘ã€æµ‹è¯•åŠæ–‡æ¡£ï¼ŒåŒ…æ‹¬ sys_trace å’Œå®éªŒæŠ¥å‘Š
```

ç„¶åéªŒè¯`git log --oneline`

è¾“å‡ºä¸º

```sh
9fba672 (HEAD -> ch4) å®Œæˆ ch4çš„ä½œä¸š rebaseä¹‹å‰çš„commit è¿˜å·®å®éªŒæŠ¥å‘Š
4014758 [chore] remove continue-on-error to confirm correctness
18b6e57 Initialize ch4
```

å®Œæˆ`rebase`åéœ€è¦å¼ºåˆ¶æ¨é€

```sh
git push --force
```

